import pandas as pd;pd.read_csv("../input/test.csv", usecols=[0,2,3]).set_index( ['item_nbr','store_nbr'] ).join(pd.read_csv( '../input/train.csv', usecols=[0,2,3,4], skiprows=range(1,124035460), converters={'unit_sales': lambda u: pd.np.log1p(float(u)) if float(u)>0 else 0} ).groupby(['item_nbr','store_nbr'])['unit_sales'].mean().to_frame( 'unit_sales' ).apply(pd.np.expm1)*.5, how='left').fillna(0).to_csv( 'meanlog.csv.gz', float_format='%.1f', index=None, compression="gzip")
